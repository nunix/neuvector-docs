"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2661],{97019:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var n=r(74848),i=r(28453);const o={title:"Deploy Using Operators",taxonomy:{category:"docs"},slug:"/deploying/production/operators"},s=void 0,a={id:"deploying/production/operators/operators",title:"Deploy Using Operators",description:"Operators",source:"@site/versioned_docs/version-5.2/02.deploying/01.production/02.operators/02.operators.md",sourceDirName:"02.deploying/01.production/02.operators",slug:"/deploying/production/operators",permalink:"/5.2/deploying/production/operators",draft:!1,unlisted:!1,editUrl:"https://github.com/neuvector/docs/edit/main/versioned_docs/version-5.2/02.deploying/01.production/02.operators/02.operators.md",tags:[],version:"5.2",sidebarPosition:2,frontMatter:{title:"Deploy Using Operators",taxonomy:{category:"docs"},slug:"/deploying/production/operators"},sidebar:"tutorialSidebar",previous:{title:"Deploy Using ConfigMap",permalink:"/5.2/deploying/production/configmap"},next:{title:"Environment Variables Details",permalink:"/5.2/deploying/production/details"}},l={},c=[{value:"Operators",id:"operators",level:3},{value:"NeuVector Operators",id:"neuvector-operators",level:3},{value:"Troubleshooting",id:"troubleshooting",level:3}];function d(e){const t={a:"a",admonition:"admonition",code:"code",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components},{Details:o}=t;return o||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h3,{id:"operators",children:"Operators"}),"\n",(0,n.jsx)(t.p,{children:"Operators take human operational knowledge and encode it into software that is more easily shared with consumers. Operators are pieces of software that ease the operational complexity of running another piece of software. More technically, Operators are a method of packaging, deploying, and managing a Kubernetes application."}),"\n",(0,n.jsx)(t.h3,{id:"neuvector-operators",children:"NeuVector Operators"}),"\n",(0,n.jsx)(t.p,{children:"The NeuVector Operator is based on the NeuVector Helm chart. The NeuVector RedHat OpenShift Operator runs in the OpenShift container platform to deploy and manage the NeuVector Security cluster components. The NeuVector Operator contains all necessary information to deploy NeuVector using Helm charts. You simply need to install the NeuVector operator from the OpenShift embedded Operator hub and create the NeuVector instance."}),"\n",(0,n.jsxs)(t.p,{children:["To deploy the latest NeuVector container versions, please use either the ",(0,n.jsx)(t.a,{href:"https://catalog.redhat.com/search?searchType=software&deployed_as=Operator&partnerName=NeuVector&p=1",children:"Red Hat Certified Operator"})," from Operator Hub or the ",(0,n.jsx)(t.a,{href:"https://github.com/redhat-openshift-ecosystem/community-operators-prod/tree/main/operators/neuvector-community-operator",children:"community operator"}),". Documentation for the community operator can be found ",(0,n.jsx)(t.a,{href:"https://github.com/neuvector/neuvector-operator",children:"here"}),"."]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.strong,{children:"Note about SCC and Upgrading"})}),"\n",(0,n.jsx)(t.p,{children:"Privileged SCC is added to the Service Account specified in the deployment yaml by Operator version 1.3.4 and above in new deployments. In the case of upgrading the NeuVector Operator from a previous version to 1.3.4, please delete Privileged SCC before upgrading."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"oc delete rolebinding -n neuvector system:openshift:scc:privileged\n"})}),"\n",(0,n.jsx)(t.admonition,{title:"important",type:"warning",children:(0,n.jsx)(t.p,{children:"NeuVector Certified Operator versions are tied to NeuVector product versions, and each new version must go through a certification process with Red Hat before being published. Certified operator version 1.3.9 is tied to NeuVector version 5.2.0. Certified operator version 1.3.7 is tied to NeuVector version 5.1.0. Version 1.3.4 operator version is tied to NeuVector 5.0.0. If you wish to be able to change the version tags of the NeuVector containers deployed, please use the Community version."})}),"\n",(0,n.jsxs)(o,{children:[(0,n.jsx)("summary",{children:"Deploy Using Certified Operator"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:(0,n.jsx)("strong",{children:"Deploy Using the\xa0Red Hat Certified Operator\xa0from Operator Hub"})}),(0,n.jsx)(t.admonition,{title:"important",type:"warning",children:(0,n.jsx)(t.p,{children:"NeuVector Operator versions are tied to NeuVector product versions, and each new product version must go through a certification process with Red Hat before being published."})}),(0,n.jsx)("p",{children:(0,n.jsx)("strong",{children:"Technical notes"})}),(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"NeuVector container images are pulled from\xa0registry.connect.redhat.com\xa0using the RedHat market place image pull secret."}),"\n",(0,n.jsx)(t.li,{children:"The NeuVector manager UI is typically exposed via an OpenShift passthrough route on a domain. For\xa0example, on IBM Cloud neuvector-route-webui-neuvector.(cluster_name)-(random_hash)-0000.(region).containers.appdomain.cloud. It can also be exposed as the service neuvector-service-webui through a node port address or public IP."}),"\n",(0,n.jsx)(t.li,{children:"OpenShift version >=4.6."}),"\n"]}),(0,n.jsxs)("ol",{children:[(0,n.jsxs)("li",{children:[(0,n.jsx)(t.p,{children:"Create the project\xa0neuvector."}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"oc new-project neuvector\n"})})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)(t.p,{children:"Apply security context constraint (SCC) to grant\xa0default\xa0service account in\xa0neuvector\xa0namespace to run privileged containers."}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"oc adm policy add-scc-to-user privileged --serviceaccount default --namespace neuvector\n"})})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)(t.p,{children:"Install the RedHat Certified Operator from the Operator Hub"}),(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"In the OpenShift Console UI, navigate to\xa0OperatorHub"}),"\n",(0,n.jsx)(t.li,{children:"Search for\xa0NeuVector Operator\xa0and select the listing without\xa0community\xa0or\xa0marketplace\xa0badge"}),"\n",(0,n.jsx)(t.li,{children:"Click\xa0Install"}),"\n"]})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)(t.p,{children:"Configure update channel"}),(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Current latest channel is\xa0beta, but may be moved to\xa0stable\xa0in the future"}),"\n",(0,n.jsx)(t.li,{children:"Select\xa0stable\xa0if available"}),"\n"]})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)(t.p,{children:"Configure installation mode and installed namespace"}),(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Select\xa0specific namespace on the cluster"}),"\n",(0,n.jsx)(t.li,{children:"Select\xa0neuvector\xa0as installed namespace"}),"\n",(0,n.jsx)(t.li,{children:"Configure approval strategy"}),"\n"]})]}),(0,n.jsx)("li",{children:"Confirm\xa0Install"}),(0,n.jsxs)("li",{children:[(0,n.jsx)(t.p,{children:"Prepare the YAML configuration values for the NeuVector installation as shown in the sample screen shot below. The YAML presented in the OpenShift Console provides all available configuration options and their default values."}),(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:r(73549).A+"",width:"673",height:"907"})})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)(t.p,{children:"When the operator is installed and\xa0ready for use, a NeuVector instance can be installed."}),(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Click\xa0View operator\xa0(after the operator installation) or select the\xa0NeuVector Operator\xa0from the\xa0Installed operators\xa0view"}),"\n",(0,n.jsx)(t.li,{children:"Click\xa0Create instance"}),"\n",(0,n.jsx)(t.li,{children:"Select\xa0Configure via YAML View"}),"\n",(0,n.jsx)(t.li,{children:"Paste the prepared YAML configuration values"}),"\n",(0,n.jsx)(t.li,{children:"Click\xa0Create"}),"\n"]})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)(t.p,{children:"Verify the installation of the NeuVector instance"}),(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Navigate to the\xa0Operator Details\xa0of the\xa0NeuVector Operator"}),"\n",(0,n.jsx)(t.li,{children:"Open the\xa0NeuVector\xa0tab"}),"\n",(0,n.jsx)(t.li,{children:"Select the\xa0neuvector-default\xa0instance"}),"\n",(0,n.jsx)(t.li,{children:"Open the\xa0Resources\xa0tab"}),"\n",(0,n.jsx)(t.li,{children:"Verify that resources are in status\xa0Created\xa0or\xa0Running"}),"\n"]})]})]}),(0,n.jsxs)(t.p,{children:["After you have successfully deployed the NeuVector Platform to your cluster, login to the NeuVector console at\xa0",(0,n.jsx)(t.a,{href:"https://neuvector-route-webui-neuvector.(OC_INGRESS)",children:"https://neuvector-route-webui-neuvector.(OC_INGRESS)"}),"."]}),(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Login with the initial username\xa0admin\xa0and password\xa0admin."}),"\n",(0,n.jsx)(t.li,{children:"Accept the NeuVector end user license agreement."}),"\n",(0,n.jsx)(t.li,{children:"Change the password of the\xa0admin\xa0user."}),"\n"]}),(0,n.jsx)(t.p,{children:"Optionally, you can also\xa0create additional users\xa0in the\xa0Settings\xa0->\xa0Users & Roles\xa0menu."}),(0,n.jsx)(t.p,{children:"Now you are ready to navigate the NeuVector console to start vulnerability scanning, observe running application pods, and apply security protections to containers."}),(0,n.jsx)("p",{children:(0,n.jsx)("strong",{children:"Upgrading NeuVector"})}),(0,n.jsx)(t.p,{children:"Upgrade the NeuVector version by updating the Operator version which is associated with the desired NeuVector version."})]})]}),"\n",(0,n.jsxs)(o,{children:[(0,n.jsx)("summary",{children:"Deploy Using Community Operator"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:(0,n.jsx)("strong",{children:"Deploy Using the NeuVector Community Operator from Operator Hub"})}),(0,n.jsx)("p",{children:(0,n.jsx)("strong",{children:"Technical notes"})}),(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"NeuVector container images are pulled from Docker Hub from the NeuVector account."}),"\n",(0,n.jsx)(t.li,{children:"NeuVector manager UI is typically exposed via an OpenShift passthrough route on a domain. For\xa0example, on IBM Cloud neuvector-route-webui-neuvector.(cluster_name)-(random_hash)-0000.(region).containers.appdomain.cloud. It can also be exposed as the service neuvector-service-webui through a node port address or public IP."}),"\n",(0,n.jsx)(t.li,{children:"OpenShift version 4.6+"}),"\n",(0,n.jsxs)(t.li,{children:["It is recommendeded to review and modify the NeuVector installation configuration by modifying the yaml values before creating the NeuVector instance. Examples include imagePullSecrets name, tag version, ingress/console access, multi-cluster federation, persistent volume PVC etc. Please refer to the Helm instructions at ",(0,n.jsx)(t.a,{href:"https://github.com/neuvector/neuvector-helm",children:"https://github.com/neuvector/neuvector-helm"})," for the values that can be modified during installation."]}),"\n"]}),(0,n.jsxs)("ol",{children:[(0,n.jsxs)("li",{children:[(0,n.jsx)(t.p,{children:"Create the project neuvector"}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"oc new-project neuvector\n"})})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)(t.p,{children:"Apply security context constraint (SCC) to grant default service account in neuvector namespace to run privileged containers."}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"oc adm policy add-scc-to-user privileged --serviceaccount default --namespace neuvector\n"})})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)(t.p,{children:"Install the NeuVector Community Operator from the Operator Hub"}),(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"In the OpenShift Console UI, navigate to OperatorHub"}),"\n",(0,n.jsx)(t.li,{children:"Search for NeuVector Operator and select the listing with the community badge"}),"\n",(0,n.jsx)(t.li,{children:"Click Install"}),"\n",(0,n.jsx)(t.li,{children:"Configure update channel. Current latest channel is beta, but may be moved to stable in the future. Select stable if available."}),"\n",(0,n.jsx)(t.li,{children:"Configure installation mode and installed namespace"}),"\n",(0,n.jsx)(t.li,{children:"Select specific namespace on the cluster"}),"\n",(0,n.jsx)(t.li,{children:"Select neuvector as installed namespace"}),"\n",(0,n.jsx)(t.li,{children:"Configure approval strategy"}),"\n",(0,n.jsx)(t.li,{children:"Confirm Install"}),"\n"]})]}),(0,n.jsx)("li",{children:"Download the Kubernetes secret manifest which contains the credentials to access the NeuVector container registry. Save the YAML manifest file to ./neuvector-secret-registry.yaml."}),(0,n.jsxs)("li",{children:[(0,n.jsx)(t.p,{children:"Apply the Kubernetes secret manifest containing the registry credentials."}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-shell",children:"kubectl apply -n neuvector -f ./neuvector-secret-registry.yaml\n"})})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)(t.p,{children:"Prepare the YAML configuration values for the NeuVector installation starting from the following YAML snippet. Be sure to specify the desired NeuVector version in the 'tag' value. Check the\xa0reference of values in the NeuVector Helm chart\xa0to get available configuration options. There are other possible Helm values which can be configured in the YAML, such as whether you will configure the cluster to allow multi-cluster management by exposing the Master (Federated Master) or remote (Federated Worker) services."}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:"apiVersion: apm.neuvector.com/v1alpha1\nkind: Neuvector\nmetadata:\n  name: neuvector-default\n  namespace: neuvector\nspec:\n  openshift: true\n  tag: 4.3.0\n  registry: docker.io\n  exporter:\n    image:\n      repository: prometheus-exporter\n      tag: 0.9.0\n  manager:\n    enabled: true\n    env:\n      ssl: true\n    image:\n      repository: manager\n    svc:\n      type: ClusterIP\n      route:\n        enabled: true\n        termination: passthrough\n  enforcer:\n    enabled: true\n    image:\n      repository: enforcer\n  cve:\n    updater:\n      enabled: true\n      image:\n        repository: updater\n        tag: latest\n      schedule: 0 0 * * *\n    scanner:\n      enabled: true\n      replicas: 3\n      image:\n        repository: scanner\n        tag: latest\n  controller:\n    enabled: true\n    image:\n      repository: controller\n    replicas: 3\n"})})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)(t.p,{children:"When the operator is installed and ready for use, a NeuVector instance can be installed."}),(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Click View operator (after the operator installation) or select the NeuVector Operator from the Installed operators view"}),"\n",(0,n.jsx)(t.li,{children:"Click Create instance"}),"\n",(0,n.jsx)(t.li,{children:"Select Configure via YAML View"}),"\n",(0,n.jsx)(t.li,{children:"Paste the prepared YAML configuration values"}),"\n",(0,n.jsx)(t.li,{children:"Click Create"}),"\n"]})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)(t.p,{children:"Verify the installation of the NeuVector instance."}),(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Navigate to the Operator Details of the NeuVector Operator"}),"\n",(0,n.jsx)(t.li,{children:"Open the NeuVector tab"}),"\n",(0,n.jsx)(t.li,{children:"Select the neuvector-default instance"}),"\n",(0,n.jsx)(t.li,{children:"Open the Resources tab"}),"\n",(0,n.jsx)(t.li,{children:"Verify that resources are in status Created or Running"}),"\n"]})]}),(0,n.jsxs)("li",{children:[(0,n.jsxs)(t.p,{children:["After you have successfully deployed the NeuVector Platform to your cluster, login to the NeuVector console at ",(0,n.jsx)(t.a,{href:"https://neuvector-route-webui-neuvector.(INGRESS_DOMAIN)",children:"https://neuvector-route-webui-neuvector.(INGRESS_DOMAIN)"}),"."]}),(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Login with the initial username admin and password admin."}),"\n",(0,n.jsx)(t.li,{children:"Accept the NeuVector end user license agreement."}),"\n",(0,n.jsx)(t.li,{children:"Change the password of the admin user."}),"\n",(0,n.jsx)(t.li,{children:"Optionally, you can also create additional users in the Settings -> Users & Roles menu."}),"\n"]})]})]}),(0,n.jsx)(t.p,{children:"Now you are ready to navigate the NeuVector console to start vulnerability scanning, observe running application pods, and apply security protections to containers."}),(0,n.jsx)("p",{children:(0,n.jsx)("strong",{children:"Upgrading NeuVector"})}),(0,n.jsxs)("ol",{children:[(0,n.jsxs)("li",{children:[(0,n.jsx)(t.p,{children:"From Operators > Installed Operators > NeuVector Operator"}),(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:r(27742).A+"",width:"1855",height:"555"})})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)(t.p,{children:"Click on NeuVector to list instances"}),(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:r(47378).A+"",width:"1851",height:"711"})})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)(t.p,{children:"Click on YAML to edit parameters"}),(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:r(57341).A+"",width:"1834",height:"881"})})]}),(0,n.jsxs)("li",{children:[(0,n.jsx)(t.p,{children:"Update tag and click Save"}),(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:r(34389).A+"",width:"1847",height:"922"})})]})]})]})]}),"\n",(0,n.jsx)(t.h3,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Check the Operator deployment values in the deployed yaml file"}),"\n",(0,n.jsx)(t.li,{children:"Verify that security context constraint (SCC) for NeuVector in step 2 was successfully added"}),"\n",(0,n.jsx)(t.li,{children:"Review and check the NeuVector Helm chart values"}),"\n",(0,n.jsx)(t.li,{children:"Make sure the registry path and version tag is set properly (community operator; certified will use the defaults)"}),"\n",(0,n.jsx)(t.li,{children:"Make sure the route to the NeuVector manager service neuvector-route-webui is configured"}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},27742:(e,t,r)=>{r.d(t,{A:()=>n});const n=r.p+"assets/images/1_Installed-3a4d17cd9d14059ff502d52b71ebdd34.png"},47378:(e,t,r)=>{r.d(t,{A:()=>n});const n=r.p+"assets/images/2_Instance-70e3fc70c8e659ee39917a6d196ef1c8.png"},57341:(e,t,r)=>{r.d(t,{A:()=>n});const n=r.p+"assets/images/3_YAML-fb949c182c0e1200c616574b7ba0d597.png"},34389:(e,t,r)=>{r.d(t,{A:()=>n});const n=r.p+"assets/images/4_tag_save-9d1222f258a44ebe586ae6f922e9a67f.png"},73549:(e,t,r)=>{r.d(t,{A:()=>n});const n=r.p+"assets/images/operator_cert-696309e11c895d34d1940b5d318f2c34.png"},28453:(e,t,r)=>{r.d(t,{R:()=>s,x:()=>a});var n=r(96540);const i={},o=n.createContext(i);function s(e){const t=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);