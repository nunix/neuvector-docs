"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8348],{29385:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>i,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>c,toc:()=>d});var t=a(74848),r=a(28453);const s={title:"Updating the CVE Database",taxonomy:{category:"docs"},slug:"/scanning/updating"},o=void 0,c={id:"scanning/updating/updating",title:"Updating the CVE Database",description:"Updating the NeuVector CVE Vulnerability Database",source:"@site/docs/06.scanning/05.updating/05.updating.md",sourceDirName:"06.scanning/05.updating",slug:"/scanning/updating",permalink:"/next/scanning/updating",draft:!1,unlisted:!1,editUrl:"https://github.com/neuvector/docs/edit/main/docs/06.scanning/05.updating/05.updating.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{title:"Updating the CVE Database",taxonomy:{category:"docs"},slug:"/scanning/updating"},sidebar:"tutorialSidebar",previous:{title:"CVE Database Sources & Version",permalink:"/next/scanning/cve_sources"},next:{title:"Parallel & Standalone Scanners",permalink:"/next/scanning/scanners"}},i={},d=[{value:"Updating the NeuVector CVE Vulnerability Database",id:"updating-the-neuvector-cve-vulnerability-database",level:3},{value:"Updater Cron Job",id:"updater-cron-job",level:4},{value:"Docker Native Updates",id:"docker-native-updates",level:3},{value:"CVE Database Version",id:"cve-database-version",level:3},{value:"Manual Updates on Kubernetes",id:"manual-updates-on-kubernetes",level:3}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h3:"h3",h4:"h4",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h3,{id:"updating-the-neuvector-cve-vulnerability-database",children:"Updating the NeuVector CVE Vulnerability Database"}),"\n",(0,t.jsxs)(n.p,{children:["The Scanner image/pod performs the scans with its internal CVE database. The scanner image is updated on the NeuVector Docker Hub registry with the latest CVE database frequently, as often as daily if there are updates. To update the CVE database used in scanning, simply pull and deploy the latest Scanner image. The latest database version number can be found listed ",(0,t.jsx)(n.a,{href:"https://raw.githubusercontent.com/neuvector/manifests/main/versions/scanner",children:"here"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"A container called the Updater performs the task of restarting the scanner pods in order to force a pull of the latest image, which will update the CVE database. To automatically check for updates and update the scanner, an updater cron job can be created."}),"\n",(0,t.jsx)(n.p,{children:"By default, the updater cron job shown below is automatically started from the sample deployment yaml files for Kubernetes and OpenShift. This will automatically check for new CVE database updates through new scanner versions published on the NeuVector Docker hub registry. Manual updates on docker native deployments are shown below. For OpenShift deployments or others where images have to be manually pulled from NeuVector, the scanner with the 'latest' tag should be pulled from NeuVector to update the CVE database."}),"\n",(0,t.jsx)(n.p,{children:"For registry scanning, if the box 'Rescan after CVE DB update' is enabled, all images in that registry will be rescanned after a CVE database update.  For run-time scanning, all running assets will be rescanned after a CVE database update if the Auto-Scan feature is enabled."}),"\n",(0,t.jsx)(n.h4,{id:"updater-cron-job",children:"Updater Cron Job"}),"\n",(0,t.jsx)(n.p,{children:"This cron job is deployed by NeuVector automatically as part of the sample deployment, so is typically not required to start manually."}),"\n",(0,t.jsx)(n.p,{children:"The Updater is a container image which, when run, restarts the scanner deployment, forcing the pull of the latest Scanner image. The updater re-deploys all scanner pods by taking the deployment to zero and scaling it back up."}),"\n",(0,t.jsx)(n.p,{children:"The cron job sample neuvector-updater.yaml below for Kubernetes 1.8 and later runs the updater every day at midnight. The schedule can be adjusted as desired."}),"\n",(0,t.jsx)(n.p,{children:"Sample updater yaml:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: batch/v1\nkind: CronJob\nmetadata:\n  name: neuvector-updater-pod\n  namespace: neuvector\nspec:\n  schedule: "0 0 * * *"\n  jobTemplate:\n    spec:\n      template:\n        metadata:\n          labels:\n            app: neuvector-updater-pod\n        spec:\n          containers:\n          - name: neuvector-updater-pod\n            image: neuvector/updater\n            imagePullPolicy: Always\n            command:\n            - /bin/sh\n            - -c\n            - TOKEN=`cat /var/run/secrets/kubernetes.io/serviceaccount/token`; /usr/bin/curl -kv -X PATCH -H "Authorization:Bearer $TOKEN" -H "Content-Type:application/strategic-merge-patch+json" -d \'{"spec":{"template":{"metadata":{"annotations":{"kubectl.kubernetes.io/restartedAt":"\'`date +%Y-%m-%dT%H:%M:%S%z`\'"}}}}}\' \'https://kubernetes.default/apis/apps/v1/namespaces/neuvector/deployments/neuvector-scanner-pod\'\n          restartPolicy: Never\n'})}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsx)(n.p,{children:"If the allinone container was deployed instead of the controller, replace neuvector-svc-controller.neuvector with neuvector-svc-allinone.neuvector"})}),"\n",(0,t.jsx)(n.p,{children:"To run the cron job"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl create -f neuvector-updater.yaml \n"})}),"\n",(0,t.jsx)(n.h3,{id:"docker-native-updates",children:"Docker Native Updates"}),"\n",(0,t.jsx)(n.admonition,{title:"important",type:"warning",children:(0,t.jsxs)(n.p,{children:["Always use the ",":latest"," tag when pulling and running the scanner image to ensure the latest CVE database is deployed."]})}),"\n",(0,t.jsx)(n.p,{children:"For docker native:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"docker stop scanner\ndocker rm <scanner id>\ndocker pull neuvector/scanner:latest\n<docker run command from below>\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"docker rm -f <scanner id>"})," can also be used to force stop and removal of the running scanner."]})}),"\n",(0,t.jsx)(n.p,{children:"For docker-compose"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"docker-compose -f file.yaml down\ndocker-compose -f file.yaml pull\t\t// pre-pull the image before starting the scanner\ndocker-compose -f file.yaml up -d\n"})}),"\n",(0,t.jsx)(n.p,{children:"Sample docker run"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker run -td --name scanner -e CLUSTER_JOIN_ADDR=controller_node_ip -e CLUSTER_ADVERTISED_ADDR=node_ip -e SCANNER_DOCKER_URL=tcp://192.168.1.10:2376 -p 18402:18402 -v /var/run/docker.sock:/var/run/docker.sock:ro neuvector/scanner:latest\n"})}),"\n",(0,t.jsx)(n.p,{children:"And sample docker-compose"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"Scanner:\n   image: neuvector/scanner:latest\n   container_name: scanner\n   environment:\n     - SCANNER_DOCKER_URL=tcp://192.168.1.10:2376\n     - CLUSTER_JOIN_ADDR=controller_node_ip\n     - CLUSTER_ADVERTISED_ADDR=node_ip\n   ports:\n     - 18402:18402\n   volumes:\n     - /var/run/docker.sock:/var/run/docker.sock:ro\n"})}),"\n",(0,t.jsx)(n.h3,{id:"cve-database-version",children:"CVE Database Version"}),"\n",(0,t.jsx)(n.p,{children:"The CVE database version can be seen in the Console in the Vulnerabilities tab. You can also inspect the scanner container logs or updater image."}),"\n",(0,t.jsx)(n.p,{children:"To use the REST API to query the version:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'curl -k -H "Content-Type: application/json" -H "X-Auth-Token: $_TOKEN_" "https://127.0.0.1:10443/v1/scan/scanner"\n'})}),"\n",(0,t.jsx)(n.p,{children:"Output:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n\t"scanners": [\n\t\t{\n\t\t\t"cvedb_create_time": "2020-07-07T10:34:04Z",\n\t\t\t"cvedb_version": "1.950",\n\t\t\t"id": "0f043705948557828ac1831ee596588a0d050950113117ddd19ecd604982f4d9",\n\t\t\t"port": 18402,\n\t\t\t"server": "127.0.0.1"\n\t\t},\n\t\t{\n\t\t\t"cvedb_create_time": "2020-07-07T10:34:04Z",\n\t\t\t"cvedb_version": "1.950",\n\t\t\t"id": "9fa02c644d603f59331c95735158d137002d32a75ed1014326f5039f38d4d717",\n\t\t\t"port": 18402,\n\t\t\t"server": "192.168.9.95"\n\t\t}\n\t]\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Using kubectl:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl logs neuvector-scanner-pod-5687dcb6fd-2h4sj -n neuvector | grep version\n"})}),"\n",(0,t.jsx)(n.p,{children:"Sample output:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"2020-09-15T00:00:57.909|DEBU|SCN|memdb.ReadCveDb: New DB found - update=2020-09-14T10:37:56Z version=2.04\n2020-09-15T00:01:10.06 |DEBU|SCN|main.scannerRegister: - entries=47016 join=neuvector-svc-controller.neuvector:18400 version=2.040\n"})}),"\n",(0,t.jsx)(n.p,{children:"Or for docker:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker logs <scanner container id or name> | grep version\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"2020-09-15T00:00:57.909|DEBU|SCN|memdb.ReadCveDb: New DB found - update=2020-09-14T10:37:56Z version=2.04\n2020-09-15T00:01:10.06 |DEBU|SCN|main.scannerRegister: - entries=47016 join=neuvector-svc-controller.neuvector:18400 version=2.040\n"})}),"\n",(0,t.jsx)(n.h3,{id:"manual-updates-on-kubernetes",children:"Manual Updates on Kubernetes"}),"\n",(0,t.jsx)(n.p,{children:"Below is an example for manually updating the CVE database on Kubernetes or OpenShift."}),"\n",(0,t.jsx)(n.p,{children:"Run the updater file below"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl create -f neuvector-manual-updater.yaml\n"})}),"\n",(0,t.jsx)(n.p,{children:"Sample file"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: Pod\nmetadata:\n  name: neuvector-updater-pod\n  namespace: neuvector\nspec:\n  containers:\n  - name: neuvector-updater-pod\n    image: neuvector/updater\n    imagePullPolicy: Always\n    command:\n    - /bin/sh\n    - -c\n    - TOKEN=`cat /var/run/secrets/kubernetes.io/serviceaccount/token`; /usr/bin/curl -kv -X PATCH -H "Authorization:Bearer $TOKEN" -H "Content-Type:application/strategic-merge-patch+json" -d \'{"spec":{"template":{"metadata":{"annotations":{"kubectl.kubernetes.io/restartedAt":"\'`date +%Y-%m-%dT%H:%M:%S%z`\'"}}}}}\' \'https://kubernetes.default/apis/apps/v1/namespaces/neuvector/deployments/neuvector-scanner-pod\'\n  restartPolicy: Never\n'})})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},28453:(e,n,a)=>{a.d(n,{R:()=>o,x:()=>c});var t=a(96540);const r={},s=t.createContext(r);function o(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);