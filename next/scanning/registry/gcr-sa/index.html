<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-scanning/registry/gcr-sa/gcr-sa" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.3.2">
<title data-rh="true">GCR Scanning using Service Accounts | Neuvector Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://open-docs.neuvector.com/next/scanning/registry/gcr-sa"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="GCR Scanning using Service Accounts | Neuvector Docs"><meta data-rh="true" name="description" content="Google GCR - Authentication/Scanning with GCP Service Accounts"><meta data-rh="true" property="og:description" content="Google GCR - Authentication/Scanning with GCP Service Accounts"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://open-docs.neuvector.com/next/scanning/registry/gcr-sa"><link data-rh="true" rel="alternate" href="https://open-docs.neuvector.com/next/scanning/registry/gcr-sa" hreflang="en"><link data-rh="true" rel="alternate" href="https://open-docs.neuvector.com/next/scanning/registry/gcr-sa" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.c7e9e479.css">
<script src="/assets/js/runtime~main.c4c275a7.js" defer="defer"></script>
<script src="/assets/js/main.86807496.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Neuvector Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo-dark.svg" alt="Neuvector Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/next/">Next 🚧</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/next/scanning/registry/gcr-sa">Next 🚧</a></li><li><a class="dropdown__link" href="/scanning/registry/gcr-sa">5.3</a></li><li><a class="dropdown__link" href="/5.2/scanning/registry/gcr-sa">5.2</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Quick Links</a><ul class="dropdown__menu"><li><a href="https://neuvector.com/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Neuvector Home<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/neuvector/neuvector/" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/neuvector/docs/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Docs GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://hub.docker.com/u/neuvector" target="_blank" rel="noopener noreferrer" class="dropdown__link">NeuVector images on Docker Hub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">More From SUSE</a><ul class="dropdown__menu"><li><a href="https://www.rancher.com" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__rancher">Rancher</a></li><li><hr style="margin: 0.3rem 0;"></li><li><a href="http://harvesterhci.io" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__harvester">Harvester</a></li><li><a href="http://fleet.rancher.io" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__fleet">Fleet</a></li><li><a href="http://kubewarden.io" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__kubewarden">Kubewarden</a></li><li><a href="https://rancherdesktop.io" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__rd">Rancher Desktop</a></li><li><hr style="margin: 0.3rem 0;"></li><li><a href="https://opensource.suse.com" target="_blank" rel="noopener noreferrer" class="dropdown__link navbar__icon navbar__suse">More Projects...</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/next/">1. Basics</a><button aria-label="Expand sidebar category &#x27;1. Basics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/next/deploying">2. Deploying NeuVector 5.x</a><button aria-label="Expand sidebar category &#x27;2. Deploying NeuVector 5.x&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/next/configuration">3. Initial Configuration &amp; Console Login</a><button aria-label="Expand sidebar category &#x27;3. Initial Configuration &amp; Console Login&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/next/navigation">4. Navigating NeuVector</a><button aria-label="Expand sidebar category &#x27;4. Navigating NeuVector&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/next/policy">5. Security Policy</a><button aria-label="Expand sidebar category &#x27;5. Security Policy&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/next/scanning">6. Security Risks, Scanning &amp; Compliance</a><button aria-label="Collapse sidebar category &#x27;6. Security Risks, Scanning &amp; Compliance&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/next/scanning/scanning">Scanning &amp; Compliance</a><button aria-label="Expand sidebar category &#x27;Scanning &amp; Compliance&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/next/scanning/registry">Registry Scanning Configuration</a><button aria-label="Collapse sidebar category &#x27;Registry Scanning Configuration&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/next/scanning/registry/harbor">Harbor Pluggable Scanner Module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/next/scanning/registry/ecr-iam">ECR Scanning using IAM Roles</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/next/scanning/registry/gcr-sa">GCR Scanning using Service Accounts</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/next/scanning/build">Build Phase Image Scanning</a><button aria-label="Expand sidebar category &#x27;Build Phase Image Scanning&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/next/scanning/cve_sources">CVE Database Sources &amp; Version</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/next/scanning/updating">Updating the CVE Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/next/scanning/scanners">Parallel &amp; Standalone Scanners</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/next/reporting">7. Reporting</a><button aria-label="Expand sidebar category &#x27;7. Reporting&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/next/integration">8. Enterprise Integration</a><button aria-label="Expand sidebar category &#x27;8. Enterprise Integration&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/next/testing">9. Testing NeuVector</a><button aria-label="Expand sidebar category &#x27;9. Testing NeuVector&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/next/updating">10. Updating NeuVector</a><button aria-label="Expand sidebar category &#x27;10. Updating NeuVector&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/next/automation">11. Workflow &amp; Automation</a><button aria-label="Expand sidebar category &#x27;11. Workflow &amp; Automation&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/next/troubleshooting">12. Troubleshooting</a><button aria-label="Expand sidebar category &#x27;12. Troubleshooting&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/next/special">13. Special Use Cases With Allinone</a><button aria-label="Expand sidebar category &#x27;13. Special Use Cases With Allinone&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/next/releasenotes">14. Release Notes</a><button aria-label="Expand sidebar category &#x27;14. Release Notes&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Neuvector Docs<!-- --> <b>Next 🚧</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/scanning/registry/gcr-sa">latest version</a></b> (<!-- -->5.3<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/next/scanning"><span itemprop="name">6. Security Risks, Scanning &amp; Compliance</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/next/scanning/registry"><span itemprop="name">Registry Scanning Configuration</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">GCR Scanning using Service Accounts</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Next 🚧</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>GCR Scanning using Service Accounts</h1></header><h3 class="anchor anchorWithStickyNavbar_LWe7" id="google-gcr---authenticationscanning-with-gcp-service-accounts">Google GCR - Authentication/Scanning with GCP Service Accounts<a href="#google-gcr---authenticationscanning-with-gcp-service-accounts" class="hash-link" aria-label="Direct link to Google GCR - Authentication/Scanning with GCP Service Accounts" title="Direct link to Google GCR - Authentication/Scanning with GCP Service Accounts">​</a></h3>
<p>It is a best practice to not depend on user attributed accounts for integrations.  GCP supports using a service account to access GCR.  Here are the steps to enable a service account for GCR and use it to trigger repository scans from NeuVector.</p>
<p>Start in NeuVector, where one first sets up a new registry:</p>
<p><img decoding="async" loading="lazy" alt="GCR" src="/assets/images/gcr1-0d22434337dad2853ac57986c57982a2.png" width="2145" height="1113" class="img_CujE"></p>
<p>By selecting Google Container Registry as the repo type, this panel is customized to accept the input required to use your GCR.</p>
<ol>
<li>Name - Here’s where you give this particular repo entry a name of your choosing. It’s merely to identify it in the NeuVector interface later on.</li>
<li>Registry - This is the first place where you’ll want to be sure the correct data is collected from your GCR instance. While the example of <a href="https://gcr.io" target="_blank" rel="noopener noreferrer">https://gcr.io</a> is the most common, we will want to be sure it accurately reflects how your GCR was set up in GCP. It might be <a href="https://us.gcr.io" target="_blank" rel="noopener noreferrer">https://us.gcr.io</a> for example. We’ll go check it in the next section.</li>
<li>JSON Key - As is pretty self-evident, this will be a JSON-formatted key. And, as you’re probably seeing a pattern set up for, we’ll be finding that via GCP.</li>
<li>Filter - Be mindful that you will likely need to replace any filters here with the actual name of the repo. Again, that’s in the GCR interface.
 
<img decoding="async" loading="lazy" alt="GCR" src="/assets/images/gcr2-30db3fc1ab89f426edc737d21af8aeea.png" width="2145" height="1246" class="img_CujE"></li>
</ol>
<p>Now let’s head on over to that GCR screen in GCP. Much of what we need is right here on this page.</p>
<p>A. See the “gcr.io” under Hostname? That’s what belongs in item #2, Registry in the NeuVector interface. (Don’t forget the https:// part)
B. The ID of the repo is actually under the top level project. This is what you will be using in #3, Filter. See example of env-demo below.</p>
<p><img decoding="async" loading="lazy" alt="GCR" src="/assets/images/gcr3-2987adbe0c13266a8a9cd6f8c75a1c70.png" width="2145" height="1100" class="img_CujE"></p>
<p>The JSON Key leads us to explore another very important step, and that takes us to the IAM &amp; Admin section of GCP where we will create (or confirm the setting of) a Service Account. See below:</p>
<p><img decoding="async" loading="lazy" alt="GCR" src="/assets/images/gcr4-671480ddf075936380c04bf782bb1803.png" width="2145" height="1769" class="img_CujE"></p>
<p>Once you enter the data for the first step of creating a service account, you need to press the “CREATE” button to get step 2 to be willing to accept input.</p>
<p><img decoding="async" loading="lazy" alt="GCR" src="/assets/images/gcr5-84fafdc269ad4ecdc38ebe919a4ff879.png" width="2154" height="1980" class="img_CujE"></p>
<p>Be sure to select Basic —&gt; Viewer for the access. If you have an existing service account, ensure that the access is set this way. (Hint: Even access permissions that appear to be more powerful don’t seem to allow for proper access. Don&#x27;t skip this step.</p>
<p>Once you’ve done this step, you can breeze past Step 3 and proceed with creating the Service Account.</p>
<p>If you don’t immediately land on the info panel for your new service account, be sure to go there on the Service Accounts list. See figure 5 below.</p>
<p><img decoding="async" loading="lazy" alt="GCR" src="/assets/images/gcr6-188c915e0e78aa6054c1bef22dfdc00d.png" width="2053" height="1741" class="img_CujE"></p>
<p>Click “ADD KEY” —&gt; “Create New Key”</p>
<p><img decoding="async" loading="lazy" alt="GCR" src="/assets/images/gcr7-0424d3dc26018129b54f2b60d4f3320f.png" width="2154" height="1530" class="img_CujE"></p>
<p>As you have already concluded, JSON is the go-to here. Selecting “CREATE” will result in a file that you can download in your browser. The contents of this file should be pasted into the 3, JSON Key field in NeuVector; see figure 1.</p>
<p>Before you get too excited there’s one more thing to ensure. In order for the scanner in NeuVector to use the API to scan and protect your images, said API must be enabled in your GCP account. You can either enable it via the command line via</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud services enable artifactregistry.googleapis.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Or you can use the GCP gui. Head to “API Library” and search for “Artifact Registry API” and ensure it is turned on for your project. See figure 7.</p>
<p><img decoding="async" loading="lazy" alt="GCR" src="/assets/images/gcr8-f617a0e44ca389e96873c77b71433a3b.png" width="2154" height="1668" class="img_CujE"></p>
<p>You should be set! See figure 8 below for a properly-configured registry using the data from our example:</p>
<p><img decoding="async" loading="lazy" alt="GCR" src="/assets/images/gcr9-6e004b6e5c7f4cfc1bd32bd37935a6f2.png" width="2145" height="1155" class="img_CujE"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="obtain-the-access-token-using-the-rest-api">Obtain the Access Token Using the REST API<a href="#obtain-the-access-token-using-the-rest-api" class="hash-link" aria-label="Direct link to Obtain the Access Token Using the REST API" title="Direct link to Obtain the Access Token Using the REST API">​</a></h4>
<p>The NeuVector REST API may be used to authenticate using the service account. The below example uses gcloud to obtain the access token.  The username is “oauth2accesstoken”.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud auth print-access-token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ya29.a0AfH6SMAvyZ2zkD3MZD_K8Lqr7qkIsRkGNqhAGthJ_A7lp8OGRe7xh5KmuQY-VJfqu83C9e1gi7A_m1InNm8QIoTGf9WHXnOeAr1gT_O6b6K667NUz1_YDunjdW09jt0XvcBGQaxjJ3c4aHlxdehBFiE_9PMk13JDt_T6f0_6vzS7</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="use-the-token-with-neuvector-repository-scanning">Use the Token with NeuVector Repository Scanning<a href="#use-the-token-with-neuvector-repository-scanning" class="hash-link" aria-label="Direct link to Use the Token with NeuVector Repository Scanning" title="Direct link to Use the Token with NeuVector Repository Scanning">​</a></h4>
<p>The below example script incorporates the access token to trigger GCR repository scan.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">_curCase_=`echo $0 | awk -F&quot;.&quot; &#x27;{print $(NF-1)}&#x27; | awk -F&quot;/&quot; &#x27;{print $NF}&#x27;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_DESC_=&quot;able to scan ubuntu:16.04 image&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_ERRCODE_=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_ERRTYPE_=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_RESULT_=&quot;pass&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># please remember to specify the controller ip address here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_controllerIP_=&quot;10.1.24.252&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_controllerRESTAPIPort_=&quot;10443&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_neuvectorUsername_=&quot;admin&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_neuvectorPassword_=&quot;admin&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_registryURL_=&quot;https://us.gcr.io/&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># registry urls could also be gcr.io, eu.gcr.io, asia.gcr.io etc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_registryUsername_=&quot;oauth2accesstoken&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_registryPassword_=$(gcloud auth print-access-token)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_repository_=&quot;bionic-union-271100/alpine&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_tag_=&quot;latest&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -k -H &quot;Content-Type: application/json&quot; -d &#x27;{&quot;password&quot;: {&quot;username&quot;: &quot;&#x27;$_neuvectorUsername_&#x27;&quot;, &quot;password&quot;: &quot;&#x27;$_neuvectorPassword_&#x27;&quot;}}&#x27; &quot;https://$_controllerIP_:$_controllerRESTAPIPort_/v1/auth&quot; &gt; /dev/null 2&gt;&amp;1 &gt; token.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_TOKEN_=`cat token.json | jq -r &#x27;.token.token&#x27;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo `date +%Y%m%d_%H%M%S` scanning an image ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -k -H &quot;Content-Type: application/json&quot; -H &quot;X-Auth-Token: $_TOKEN_&quot; -d &#x27;{&quot;request&quot;: {&quot;registry&quot;: &quot;&#x27;$_registryURL_&#x27;&quot;, &quot;username&quot;: &quot;&#x27;$_registryUsername_&#x27;&quot;, &quot;password&quot;: &quot;&#x27;$_registryPassword_&#x27;&quot;, &quot;repository&quot;: &quot;&#x27;$_repository_&#x27;&quot;, &quot;tag&quot;: &quot;&#x27;$_tag_&#x27;&quot;}}&#x27; &quot;https://$_controllerIP_:$_controllerRESTAPIPort_/v1/scan/repository&quot; &gt; /dev/null 2&gt;&amp;1 &gt; scan_repository.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">while [ `wc -c &lt; scan_repository.json` = &quot;0&quot; ]; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> echo `date +%Y%m%d_%H%M%S` scanning is still in progress ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sleep 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    curl -k -H &quot;Content-Type: application/json&quot; -H &quot;X-Auth-Token: $_TOKEN_&quot; -d &#x27;{&quot;request&quot;: {&quot;registry&quot;: &quot;&#x27;$_registryURL_&#x27;&quot;, &quot;username&quot;: &quot;&#x27;$_registryUsername_&#x27;&quot;, &quot;password&quot;: &quot;&#x27;$_registryPassword_&#x27;&quot;, &quot;repository&quot;: &quot;&#x27;$_repository_&#x27;&quot;, &quot;tag&quot;: &quot;&#x27;$_tag_&#x27;&quot;}}&#x27; &quot;https://$_controllerIP_:$_controllerRESTAPIPort_/v1/scan/repository&quot; &gt; /dev/null 2&gt;&amp;1 &gt; scan_repository.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo `date +%Y%m%d_%H%M%S` log out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -k -X &#x27;DELETE&#x27; -H &quot;Content-Type: application/json&quot; -H &quot;X-Auth-Token: $_TOKEN_&quot; &quot;https://$_controllerIP_:$_controllerRESTAPIPort_/v1/auth&quot; &gt; /dev/null 2&gt;&amp;1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat scan_repository.json | jq .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm *.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo `date +%Y%m%d_%H%M%S` [$_curCase_] $_DESC_: $_RESULT_-$_ERRCODE_</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/neuvector/docs/edit/main/docs/06.scanning/02.registry/03.gcr-sa/03.gcr-sa.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/next/scanning/registry/ecr-iam"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">ECR Scanning using IAM Roles</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/next/scanning/build"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Build Phase Image Scanning</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#google-gcr---authenticationscanning-with-gcp-service-accounts" class="table-of-contents__link toc-highlight">Google GCR - Authentication/Scanning with GCP Service Accounts</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 SUSE NeuVector. All Rights Reserved.</div></div></div></footer></div>
</body>
</html>